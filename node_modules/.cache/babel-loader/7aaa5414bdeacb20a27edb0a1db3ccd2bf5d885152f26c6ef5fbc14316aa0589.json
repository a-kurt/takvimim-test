{"ast":null,"code":"import _regeneratorRuntime from\"/home/atakan/Desktop/takvimim-test/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/atakan/Desktop/takvimim-test/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/atakan/Desktop/takvimim-test/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from\"react\";import{Link,useNavigate,useLocation,resolvePath}from\"react-router-dom\";import axios from\"../api/axios\";import useAuth from\"../hooks/useAuth\";import AuthContext from\"../context/AuthProvider\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LOGIN_URL=\"/api/v1/auth/authenticate\";var Login=function Login(){var _location$state,_location$state$from;var _useAuth=useAuth(AuthContext),setAuth=_useAuth.setAuth;var navigate=useNavigate();var location=useLocation();var from=((_location$state=location.state)===null||_location$state===void 0?void 0:(_location$state$from=_location$state.from)===null||_location$state$from===void 0?void 0:_location$state$from.pathname)||\"/\";var emailRef=useRef();var errRef=useRef();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),errMsg=_useState6[0],setErrMsg=_useState6[1];useEffect(function(){emailRef.current.focus();},[]);useEffect(function(){setErrMsg('');},[email,password]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _response$data,_response$data2,_response$data3,_response$data4,response,accessToken,id,role,verified,_err$response,_err$response2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return axios.post(LOGIN_URL,JSON.stringify({email:email,password:password}),{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 4:response=_context.sent;accessToken=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.token;id=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.id;role=response===null||response===void 0?void 0:(_response$data3=response.data)===null||_response$data3===void 0?void 0:_response$data3.role;verified=response===null||response===void 0?void 0:(_response$data4=response.data)===null||_response$data4===void 0?void 0:_response$data4.verified;if(verified===false){navigate(\"/verification\");}else{setAuth({accessToken:accessToken,id:id,role:role});setEmail('');setPassword('');navigate(from,{replace:true});}_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);if(!(_context.t0!==null&&_context.t0!==void 0&&_context.t0.response)){setErrMsg(\"No Server Response\");}else if(((_err$response=_context.t0.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setErrMsg(\"Missing Email or Password\");}else if(((_err$response2=_context.t0.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setErrMsg(\"Unauthhorized\");}else{setErrMsg(\"Login Failed\");}errRef.current.focus();case 16:case\"end\":return _context.stop();}},_callee,null,[[1,12]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errMsg?\"errmsg\":\"offscreen\",\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-white rounded-lg md:mt-0 sm:max-w-md xl:p-0\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 space-y-4 md:space-y-6 sm:p-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold leading-tight tracking-tight text-blue-500 md:text-2xl text-center\",children:\"Giri\\u015F Yap\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"space-y-4 md:space-y-6\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",id:\"email\",ref:emailRef,autoComplete:\"off\",onChange:function onChange(e){return setEmail(e.target.value);},value:email,className:\"text-[#374754] bg-white border-[#8EC2F2] border-2 sm:text-sm rounded-sm focus:outline-none focus:border-[#2091F9] block w-full p-2.5\",placeholder:\"E-Posta\",required:true})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",id:\"password\",onChange:function onChange(e){return setPassword(e.target.value);},value:password,placeholder:\"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\",className:\"text-[#374754] bg-white border-[#8EC2F2] border-2 sm:text-sm rounded-sm focus:outline-none focus:border-[#2091F9] block w-full p-2.5\",required:true})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full text-white bg-blue-500 hover:bg-blue-600 focus:outline-none font-medium rounded-sm text-sm px-5 py-4 text-center\",children:\"Giri\\u015F Yap\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-[#374754] text-center\",children:[\"Hesab\\u0131n yok mu?\",\" \",/*#__PURE__*/_jsx(Link,{to:\"/register\",className:\"font-medium text-blue-500 hover:underline\",children:\"Hesap Olu\\u015Ftur\"})]})]})]})})})]});};export default Login;","map":{"version":3,"names":["React","useEffect","useRef","useState","Link","useNavigate","useLocation","resolvePath","axios","useAuth","AuthContext","jsx","_jsx","jsxs","_jsxs","LOGIN_URL","Login","_location$state","_location$state$from","_useAuth","setAuth","navigate","location","from","state","pathname","emailRef","errRef","_useState","_useState2","_slicedToArray","email","setEmail","_useState3","_useState4","password","setPassword","_useState5","_useState6","errMsg","setErrMsg","current","focus","handleSubmit","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","_response$data","_response$data2","_response$data3","_response$data4","response","accessToken","id","role","verified","_err$response","_err$response2","wrap","_callee$","_context","prev","next","preventDefault","post","JSON","stringify","headers","withCredentials","sent","data","token","replace","t0","status","stop","_x","apply","arguments","children","ref","className","onSubmit","type","name","autoComplete","onChange","target","value","placeholder","required","to"],"sources":["/home/atakan/Desktop/takvimim-test/src/components/Login.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { Link, useNavigate, useLocation, resolvePath } from \"react-router-dom\";\nimport axios from \"../api/axios\";\nimport useAuth from \"../hooks/useAuth\";\nimport AuthContext from \"../context/AuthProvider\";\n\nconst LOGIN_URL = \"/api/v1/auth/authenticate\";\n\n\nconst Login = () => {\n  const { setAuth } = useAuth(AuthContext);\n\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = location.state?.from?.pathname || \"/\";\n\n  const emailRef = useRef();\n  const errRef = useRef();\n\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [errMsg, setErrMsg] = useState(\"\");\n\n  useEffect(() => {\n    emailRef.current.focus();\n  }, [])\n\n  useEffect(() => {\n    setErrMsg('');\n  }, [email, password]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n \n\n    try {\n      const response = await axios.post(\n        LOGIN_URL,\n        JSON.stringify({ email: email, password: password }),\n        {\n          headers: { \"Content-Type\": \"application/json\" },\n          withCredentials: true,\n        }\n      );\n      \n      const accessToken = response?.data?.token;\n      const id = response?.data?.id;\n      const role = response?.data?.role;\n      const verified = response?.data?.verified;\n      \n      if (verified === false) {\n        navigate(\"/verification\");\n      } else {\n        setAuth({ accessToken, id, role });\n        setEmail('');\n        setPassword('');\n        \n        navigate(from, { replace: true });\n      }\n    } catch (err) {\n      if (!err?.response) {\n        setErrMsg(\"No Server Response\");\n      } else if (err.response?.status === 400) {\n        setErrMsg(\"Missing Email or Password\");\n      } else if (err.response?.status === 401) {\n        setErrMsg(\"Unauthhorized\");\n      }\n      else {\n        setErrMsg(\"Login Failed\");\n      }\n      errRef.current.focus();\n    }\n  };\n\n  return (\n    <section>\n      <p\n        ref={errRef}\n        className={errMsg ? \"errmsg\" : \"offscreen\"}\n        aria-live=\"assertive\"\n      >\n        {errMsg}\n      </p>\n      <div className=\"flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0\">\n        <div className=\"w-full bg-white rounded-lg md:mt-0 sm:max-w-md xl:p-0\">\n          <div className=\"p-6 space-y-4 md:space-y-6 sm:p-8\">\n            <h1 className=\"text-xl font-bold leading-tight tracking-tight text-blue-500 md:text-2xl text-center\">\n              Giriş Yap\n            </h1>\n            <form className=\"space-y-4 md:space-y-6\" onSubmit={handleSubmit}>\n              <div>\n                <input\n                  type=\"email\"\n                  name=\"email\"\n                  id=\"email\"\n                  ref={emailRef}\n                  autoComplete=\"off\"\n                  onChange={(e) => setEmail(e.target.value)}\n                  value={email}\n                  className=\"text-[#374754] bg-white border-[#8EC2F2] border-2 sm:text-sm rounded-sm focus:outline-none focus:border-[#2091F9] block w-full p-2.5\"\n                  placeholder=\"E-Posta\"\n                  required\n                />\n              </div>\n              <div>\n                <input\n                  type=\"password\"\n                  name=\"password\"\n                  id=\"password\"\n                  onChange={(e) => setPassword(e.target.value)}\n                  value={password}\n                  placeholder=\"••••••••\"\n                  className=\"text-[#374754] bg-white border-[#8EC2F2] border-2 sm:text-sm rounded-sm focus:outline-none focus:border-[#2091F9] block w-full p-2.5\"\n                  required\n                />\n              </div>\n\n              <button\n                type=\"submit\"\n                className=\"w-full text-white bg-blue-500 hover:bg-blue-600 focus:outline-none font-medium rounded-sm text-sm px-5 py-4 text-center\"\n              >\n                Giriş Yap\n              </button>\n              <p className=\"text-sm text-[#374754] text-center\">\n                Hesabın yok mu?{\" \"}\n                <Link\n                  to=\"/register\"\n                  className=\"font-medium text-blue-500 hover:underline\"\n                >\n                  Hesap Oluştur\n                </Link>\n              </p>\n            </form>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default Login;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}